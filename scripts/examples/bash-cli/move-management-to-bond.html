<!DOCTYPE html PUBLIC "-//IETF//DTD HTML 2.0//EN">
<HTML>
<HEAD>
<TITLE>Enscript Output</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#1F00FF" ALINK="#FF0000" VLINK="#9900DD">
<A NAME="top">
<A NAME="file1">
<H1>move-management-to-bond</H1>

<PRE>
<B><FONT COLOR="#5F9EA0">#!/bin/sh
</FONT></B>
<I><FONT COLOR="#B22222"># Find hosts which are still using a bond 'slave' for their management interface
</FONT></I><I><FONT COLOR="#B22222"># and try to move them onto the bond 'master' (ie activate the bond). Will
</FONT></I><I><FONT COLOR="#B22222"># only work if there are no active guest VIFs.
</FONT></I>
<FONT COLOR="#B8860B">IFS</FONT>=<B><FONT COLOR="#BC8F8F">&quot;,&quot;</FONT></B>; <B><FONT COLOR="#A020F0">for</FONT></B> bond <B><FONT COLOR="#A020F0">in</FONT></B> $(xe bond-list params=uuid --minimal); <B><FONT COLOR="#A020F0">do</FONT></B>
  master=$(xe bond-list uuid=$bond params=master --minimal)
  <FONT COLOR="#B8860B">IFS</FONT>=<B><FONT COLOR="#BC8F8F">&quot;;&quot;</FONT></B>; <B><FONT COLOR="#A020F0">for</FONT></B> slave <B><FONT COLOR="#A020F0">in</FONT></B> $(xe bond-list uuid=$bond params=slaves --minimal); <B><FONT COLOR="#A020F0">do</FONT></B>
     <FONT COLOR="#B8860B">IFS</FONT>=<B><FONT COLOR="#BC8F8F">&quot;,&quot;</FONT></B>; <B><FONT COLOR="#A020F0">for</FONT></B> pif <B><FONT COLOR="#A020F0">in</FONT></B> $(xe pif-list uuid=$slave management=true --minimal); <B><FONT COLOR="#A020F0">do</FONT></B>
       <B><FONT COLOR="#DA70D6">echo</FONT></B> Found a slave management PIF: $pif
       mode=$(xe pif-list uuid=$pif params=IP-configuration-mode --minimal)
       ip=$(xe pif-list uuid=$pif params=IP --minimal)
       netmask=$(xe pif-list uuid=$pif params=netmask --minimal)
       gateway=$(xe pif-list uuid=$pif params=gateway --minimal)
       dns=$(xe pif-list uuid=$pif params=DNS --minimal)
       <B><FONT COLOR="#DA70D6">echo</FONT></B> Setting IP configuration on bond PIF: $master
       xe pif-reconfigure-ip uuid=$master mode=$mode IP=$ip netmask=$netmask gateway=$gateway DNS=$dns
       host=$(xe pif-list uuid=$master params=host-uuid --minimal)
       <B><FONT COLOR="#DA70D6">echo</FONT></B> Moving management interface of host $host to bond
       xe host-management-reconfigure pif-uuid=$master
     <B><FONT COLOR="#A020F0">done</FONT></B>
  <B><FONT COLOR="#A020F0">done</FONT></B>
<B><FONT COLOR="#A020F0">done</FONT></B>
</PRE>
<HR>
<ADDRESS>Generated by <A HREF="http://www.iki.fi/~mtr/genscript/">GNU enscript 1.6.4</A>.</ADDRESS>
</BODY>
</HTML>
